# 甲方数据接入检查清单

## 📋 验收前准备（验收前1周）

### 🔧 技术准备
- [ ] **系统功能验证完成**
  - [ ] 所有核心功能测试通过
  - [ ] 性能测试达标
  - [ ] 安全测试完成
  - [ ] 压力测试通过

- [ ] **部署环境准备**
  - [ ] 生产服务器配置完成
  - [ ] 网络环境测试通过
  - [ ] 防火墙规则配置
  - [ ] 监控系统部署

- [ ] **文档准备**
  - [ ] 技术文档完整
  - [ ] 用户操作手册
  - [ ] 运维手册
  - [ ] 故障排除指南
  - [ ] API接口文档

### 📊 甲方信息收集
- [ ] **数据源信息**
  - [ ] 数据源类型确认（MQTT/HTTP/Database）
  - [ ] 连接地址和端口
  - [ ] 认证信息（用户名/密码/证书）
  - [ ] 数据更新频率
  - [ ] 数据保留策略

- [ ] **数据格式样本**
  - [ ] 船只状态数据样本
  - [ ] 船坞信息数据样本
  - [ ] 航线定义数据样本
  - [ ] 异常数据样本
  - [ ] 数据字典文档

- [ ] **业务规则确认**
  - [ ] 告警阈值设置
  - [ ] 优先级规则
  - [ ] 业务流程确认
  - [ ] 异常处理策略

## 🔌 数据接入实施（验收当天）

### 第一步：环境连接测试
```bash
# 1. 网络连通性测试
ping [甲方服务器地址]
telnet [甲方服务器地址] [端口]

# 2. MQTT连接测试（如适用）
mosquitto_sub -h [甲方MQTT地址] -p [端口] -u [用户名] -P [密码] -t "#" -C 1

# 3. HTTP API测试（如适用）
curl -X GET "http://[甲方API地址]/health" -H "Authorization: Bearer [token]"

# 4. 数据库连接测试（如适用）
mysql -h [甲方数据库地址] -u [用户名] -p[密码] -e "SELECT 1"
```

**验收标准**: ✅ 所有连接测试通过

### 第二步：数据格式验证
```bash
# 1. 获取实际数据样本
mosquitto_sub -h [甲方MQTT地址] -t "[船只状态主题]" -C 5 > real_data_sample.json

# 2. 验证JSON格式
cat real_data_sample.json | python3 -m json.tool

# 3. 检查必需字段
python3 -c "
import json
with open('real_data_sample.json') as f:
    for line in f:
        data = json.loads(line)
        required_fields = ['vessel_id', 'timestamp', 'position', 'navigation']
        missing = [f for f in required_fields if f not in data]
        if missing:
            print(f'Missing fields: {missing}')
        else:
            print('All required fields present')
"
```

**验收标准**: ✅ 数据格式符合预期，包含所有必需字段

### 第三步：数据转换测试
```bash
# 1. 编译数据转换器
cd build && make

# 2. 测试数据转换
./test_data_converter real_data_sample.json

# 3. 验证转换结果
python3 -c "
import json
# 验证转换后的数据格式
with open('converted_data.json') as f:
    data = json.load(f)
    required = ['sysid', 'timestamp', 'lat', 'lng', 'heading', 'speed', 'status', 'route_direction']
    missing = [f for f in required if f not in data]
    if missing:
        print(f'Conversion failed: missing {missing}')
    else:
        print('Conversion successful')
"
```

**验收标准**: ✅ 数据转换正确，输出格式符合系统要求

### 第四步：系统集成测试
```bash
# 1. 启动系统监控
mosquitto_sub -h localhost -t "boat_safety/output/+" > integration_test.log &

# 2. 启动安全预测系统
./mqtt_example --config config/production_config.json &
SYSTEM_PID=$!

# 3. 等待系统启动
sleep 5

# 4. 检查系统状态
if ps -p $SYSTEM_PID > /dev/null; then
    echo "✅ 系统启动成功"
else
    echo "❌ 系统启动失败"
fi

# 5. 验证数据处理
sleep 30
if grep -q "Updated boat state" integration_test.log; then
    echo "✅ 数据处理正常"
else
    echo "❌ 数据处理异常"
fi
```

**验收标准**: ✅ 系统正常启动并处理甲方数据

### 第五步：功能验收测试
```bash
# 1. 碰撞告警功能测试
# 发送高速船只数据，验证告警生成
mosquitto_pub -h localhost -t "boat_safety/input/boat_state/test" \
  -m '{"sysid":999,"timestamp":'$(date +%s)',"lat":30.549832,"lng":114.342922,"heading":90.0,"speed":4.0,"status":2,"route_direction":1}'

# 2. 船坞管理功能测试
mosquitto_pub -h localhost -t "boat_safety/dock_management/1/lock_request" \
  -m '{"dock_id":1,"boat_id":999,"operation":"lock","timestamp":'$(date +%s)'}'

# 3. 系统状态监控测试
timeout 5s mosquitto_sub -h localhost -t "boat_safety/output/system_status" -C 1
```

**验收标准**: ✅ 所有核心功能正常工作

## 📊 验收测试记录表

### 基础环境验收
| 检查项目 | 预期结果 | 实际结果 | 状态 | 备注 |
|----------|----------|----------|------|------|
| 服务器环境 | 满足最低配置要求 | | ⬜ | |
| 网络连接 | 能访问甲方数据源 | | ⬜ | |
| MQTT服务 | 正常运行 | | ⬜ | |
| 系统编译 | 无错误 | | ⬜ | |
| 权限配置 | 正确设置 | | ⬜ | |

### 数据接入验收
| 检查项目 | 预期结果 | 实际结果 | 状态 | 备注 |
|----------|----------|----------|------|------|
| 数据源连接 | 连接成功 | | ⬜ | |
| 数据接收 | 能接收实时数据 | | ⬜ | |
| 数据格式 | 符合预期格式 | | ⬜ | |
| 数据转换 | 转换正确 | | ⬜ | |
| 数据验证 | 通过验证规则 | | ⬜ | |

### 功能验收
| 功能模块 | 测试用例 | 预期结果 | 实际结果 | 状态 | 备注 |
|----------|----------|----------|----------|------|------|
| 船只状态处理 | 发送船只数据 | 正确处理和存储 | | ⬜ | |
| 碰撞告警 | 高速船只场景 | 生成告警 | | ⬜ | |
| 船坞管理 | 锁定/解锁请求 | 正确响应 | | ⬜ | |
| 航线管理 | 航线信息处理 | 正确解析 | | ⬜ | |
| 系统监控 | 状态查询 | 返回正确状态 | | ⬜ | |

### 性能验收
| 性能指标 | 要求 | 实际值 | 状态 | 备注 |
|----------|------|--------|------|------|
| 数据处理延迟 | < 1秒 | | ⬜ | |
| 系统响应时间 | < 500ms | | ⬜ | |
| 内存使用 | < 500MB | | ⬜ | |
| CPU使用率 | < 50% | | ⬜ | |
| 并发处理能力 | 支持30艘船 | | ⬜ | |

### 稳定性验收
| 测试项目 | 测试时长 | 预期结果 | 实际结果 | 状态 | 备注 |
|----------|----------|----------|----------|------|------|
| 连续运行 | 24小时 | 无异常退出 | | ⬜ | |
| 网络断开恢复 | 模拟断网 | 自动重连 | | ⬜ | |
| 异常数据处理 | 发送错误数据 | 优雅处理 | | ⬜ | |
| 内存泄漏 | 长时间运行 | 内存稳定 | | ⬜ | |

## 🚨 问题处理流程

### 常见问题及解决方案

#### 问题1: 无法连接甲方数据源
**可能原因**:
- 网络不通
- 认证信息错误
- 防火墙阻拦
- 服务未启动

**解决步骤**:
1. 检查网络连通性: `ping [甲方地址]`
2. 验证端口开放: `telnet [甲方地址] [端口]`
3. 确认认证信息: 联系甲方确认用户名密码
4. 检查防火墙: `sudo ufw status`
5. 联系甲方确认服务状态

#### 问题2: 数据格式不匹配
**可能原因**:
- 甲方数据格式变更
- 字段名称不一致
- 数据类型不匹配
- 缺少必需字段

**解决步骤**:
1. 获取最新数据样本
2. 对比数据格式差异
3. 修改数据转换器
4. 重新测试转换结果
5. 更新文档

#### 问题3: 系统性能不达标
**可能原因**:
- 服务器配置不足
- 数据处理逻辑复杂
- 网络延迟高
- 并发处理能力不足

**解决步骤**:
1. 监控系统资源使用
2. 优化数据处理算法
3. 调整系统配置参数
4. 考虑硬件升级
5. 实施负载均衡

#### 问题4: 功能异常
**可能原因**:
- 业务逻辑错误
- 配置参数不正确
- 依赖服务异常
- 代码bug

**解决步骤**:
1. 查看系统日志
2. 检查配置文件
3. 验证依赖服务
4. 调试代码逻辑
5. 修复并重新测试

## 📞 验收支持联系方式

### 技术支持团队
- **技术负责人**: [姓名] - [电话] - [邮箱]
- **系统架构师**: [姓名] - [电话] - [邮箱]
- **运维工程师**: [姓名] - [电话] - [邮箱]

### 项目管理团队
- **项目经理**: [姓名] - [电话] - [邮箱]
- **质量经理**: [姓名] - [电话] - [邮箱]

### 紧急联系
- **24小时技术热线**: [电话]
- **紧急邮箱**: [邮箱]

### 服务承诺
- **响应时间**: 工作时间内2小时响应
- **解决时间**: 一般问题24小时内解决
- **现场支持**: 验收期间全程现场支持
- **远程支持**: 验收后3个月免费远程支持

## ✅ 验收完成确认

### 验收签字确认
```
甲方代表签字: _________________ 日期: _________
职务: _________________

乙方代表签字: _________________ 日期: _________
职务: _________________

项目经理签字: _________________ 日期: _________

技术负责人签字: _______________ 日期: _________
```

### 验收结论
- [ ] **通过验收** - 系统完全满足要求，可投入生产使用
- [ ] **有条件通过** - 系统基本满足要求，需修复以下问题后投入使用：
  - 问题1: ________________________________
  - 问题2: ________________________________
  - 问题3: ________________________________
- [ ] **不通过验收** - 系统存在重大问题，需重新开发后再次验收

### 后续工作安排
- [ ] 生产环境部署
- [ ] 用户培训安排
- [ ] 运维交接
- [ ] 技术文档移交
- [ ] 质保期服务安排
